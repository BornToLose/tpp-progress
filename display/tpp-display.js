function toggleSetting(e){var t=e.id;settings[t]=e.checked,localStorage.setItem("settings",JSON.stringify(settings)),$.when((baseSettings[t].extraAction||function(){})()).always(updatePage)}function toggleGroup(e){var t=e.id.split("-").pop(),n=e.checked;showGroups[t]=n,localStorage.setItem("showGroups",JSON.stringify(showGroups)),$("."+t.replace(/[^A-Z0-9]/gi,"")).toggleClass("hidden",!n),updatePage()}function SerializeQueryString(){return Object.keys(QueryString).filter(function(e){return QueryString[e]}).length?"?"+Object.keys(QueryString).filter(function(e){return QueryString[e]}).map(function(e){return e+("true"==QueryString[e]?"":"="+encodeURI(QueryString[e]))}).join("&"):""}function updateGroups(){if(groups&&groupList){var e=$find([groupList],"input").pop().map(function(e){return e.id.split("-").pop()})||[];Object.keys(groups).filter(function(t){return e.indexOf(t)<0}).forEach(function(e){var t=document.createElement("li"),n=document.createElement("input"),r=document.createElement("label");t.appendChild(n),t.appendChild(r),groupList.appendChild(t),n.type="checkbox",r.htmlFor=n.id="group-"+e,n.checked=showGroups[e]!==!1,r.innerText=groups[e],n.onchange=function(){return toggleGroup(n)}})}}function icon(e,t,n){var r=document.createElement("i");return r.classList.add("fa",e),r.title=t,n&&(r.onclick=n),r}function listControl(e,t){var n=document.createElement("li");n.appendChild(icon(e,t));var r=document.createElement("ul");return n.appendChild(r),{controlElement:n,listElement:r}}function qsListMenu(e,t,n,r,i,o){void 0===i&&(i="All"),void 0===o&&(o="");var s=listControl(e,t),a=QueryString[n];return QueryString[n]=null,r.forEach(function(e){var t=document.createElement("li"),r=document.createElement("a");e?r.innerText=r.innerHTML=o+(QueryString[n]=e):r.innerText=r.innerHTML=i,r.href=window.location.href.split("?").shift()+SerializeQueryString(),s.listElement.appendChild(t),t.appendChild(r),a==e&&t.classList.add("selected")}),QueryString[n]=a,s.controlElement}function qsOptionsMenu(e,t,n){var r=listControl(e,t);return Object.keys(n).forEach(function(e){var t=document.createElement("li"),i=document.createElement("a"),o=QueryString[e];QueryString[e]=o?null:"true",i.innerText=i.innerHTML=n[e],i.href=window.location.href.split("?").shift()+SerializeQueryString(),r.listElement.appendChild(t),t.appendChild(i),QueryString[e]=o,o&&t.classList.add("selected")}),r.controlElement}function zoomButtons(){var e=document.createElement("li"),t=document.createElement("li");return e.appendChild(icon("fa-search-plus","Zoom In",function(){return zoomIn()})),t.appendChild(icon("fa-search-minus","Zoom Out",function(){return zoomOut()})),[e,t]}function settingsMenu(){var e=listControl("fa-gear","Settings");return Object.keys(baseSettings).forEach(function(t){var n=document.createElement("li"),r=document.createElement("input");r.type="checkbox",r.id=t,r.checked=settings[t],r.onchange=function(){return toggleSetting(r)},n.appendChild(r);var i=document.createElement("label");i.htmlFor=r.id,i.innerText=i.innerHTML=baseSettings[t].displayName,n.appendChild(i),e.listElement.appendChild(n)}),e.controlElement.classList.add("settings"),e.controlElement}function groupsMenu(){var e=listControl("fa-eye","Groups");return groupList=e.listElement,e.controlElement.classList.add("groups"),updateGroups(),e.controlElement}function dayMenu(e){void 0===e&&(e=40);var t=0,n=parseInt(QueryString.day||"0")||0;Array.isArray(e)?e.forEach(function(e){return e.Runs.forEach(function(r){return t=Math.max(t,Math.ceil(TPP.Duration.parse(r.Duration,r.StartTime).TotalTime(e.Scale)+(e.Offset||0)+n))})}):t=e;var r=listControl("fa-calendar","Day"),i=document.createElement("li"),o=document.createElement("select");o.id="day";for(var s=0;s<t+1;s++){var a=document.createElement("option");s?a.value=a.innerText=a.innerHTML=s.toFixed(0):a.innerText=a.innerHTML="All",n==s&&(a.selected=!0),o.appendChild(a)}var u=document.createElement("label");return u.htmlFor=o.id,u.innerHTML="Day:&nbsp;",i.appendChild(u),i.appendChild(o),r.listElement.appendChild(i),o.onchange=function(){QueryString.day="All"==o.value?null:o.value,window.location.href=window.location.href.split("?").shift()+SerializeQueryString()},r.controlElement}function regionMenu(e){var t;if(e[0]&&e[0].Name){var n=e;t=[],n.forEach(function(e){e.Runs.forEach(function(e){e.Unfinished||(e.Region&&t.indexOf(e.Region)<0&&t.push(e.Region),(e.AdditionalRegions||[]).forEach(function(e){e.Name&&t.indexOf(e.Name)<0&&t.push(e.Name)}))})})}else t=e;return qsListMenu("fa-globe","Region","region",t)}function twitchButton(){var e=document.createElement("li");return e.appendChild(icon("fa-twitch","Twitch Videos",function(){return getTwitchVideos()})),e}function defaultControls(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=zoomButtons();return n.push(settingsMenu()),n.push(groupsMenu()),e.forEach(function(e){return n.push(e)}),n.push(twitchButton()),n}function drawControls(e,t){t=t||(document.currentScript||Array.prototype.concat.apply([],document.getElementsByTagName("script")).pop()).parentElement,e.forEach(function(e){t.appendChild(e),t.appendChild(document.createTextNode("\n"))})}var fakeQuery=function(e){return Array.prototype.slice.call(document.querySelectorAll(e))},$find=function(e,t){return e.map(function(e){return e?Array.prototype.slice.call(e.querySelectorAll(t)):[]})},updatePage=updatePage||function(){},reprocessCharts=reprocessCharts||function(){},baseSettings={explode:{displayName:"Stagger Clumps",defaultValue:!0},hideUnfinished:{displayName:"Hide Runs Left Unfinished",defaultValue:!0,extraAction:reprocessCharts}},settings=JSON.parse(localStorage.getItem("settings")||"{}");Object.keys(baseSettings).forEach(function(e){return settings[e]="boolean"==typeof settings[e]?settings[e]:baseSettings[e].defaultValue});var showGroups=JSON.parse(localStorage.getItem("showGroups")||"{}"),TPP;!function(e){var t;!function(e){e[e.Weeks=0]="Weeks",e[e.Days=1]="Days",e[e.Hours=2]="Hours",e[e.Minutes=3]="Minutes"}(t=e.Scale||(e.Scale={}))}(TPP||(TPP={}));var Twitch;!function(e){function t(e,t){void 0===t&&(t=!0);var r=[],o=function(e){return e.videos.length&&(r=r.concat.apply(r,e.videos.map(function(e){return new i(e.recorded_at,e.length,e.url,"Twitch")})),t&&e._total)?n(e._links.next).then(o):r};return $.when(n("https://api.twitch.tv/kraken/channels/"+e+"/videos?broadcasts=true&limit=100").then(o),n("https://api.twitch.tv/kraken/channels/"+e+"/videos?limit=100").then(o))}function n(e){return $.get(e+(e.indexOf("?")>0?"&":"?")+"client_id="+r)}var r="l6ejgsj101ymei0f6v4a6nkjw9upml9",i=function(){function e(e,t,n,r){this.recorded_at=e,this.length=t,this.url=n,this.source=r,this.StartTime=new Date(e).valueOf()/1e3,this.EndTime=this.StartTime+t}return e}();e.Video=i,e.GetVideos=t}(Twitch||(Twitch={}));var TPP;!function(e){var t=function(){function t(e,n,r,i,o){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),this.days=n,this.hours=r,this.minutes=i,this.seconds=o,"string"==typeof e){var s=t.parse(e);this.days=s.days,this.hours=s.hours,this.minutes=s.minutes,this.seconds=s.seconds}else this.days+=7*e}return Object.defineProperty(t.prototype,"TotalSeconds",{get:function(){return this.seconds+60*this.minutes+60*this.hours*60+60*this.days*60*24},set:function(e){this.seconds=Math.floor(e%60),this.minutes=Math.floor(e/60)%60,this.hours=Math.floor(e/60/60)%24,this.days=Math.floor(e/60/60/24)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TotalHours",{get:function(){return this.TotalSeconds/60/60},set:function(e){this.TotalSeconds=60*e*60},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TotalDays",{get:function(){return this.TotalHours/24},set:function(e){this.TotalHours=24*e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TotalWeeks",{get:function(){return this.TotalDays/7},set:function(e){this.TotalDays=7*e},enumerable:!0,configurable:!0}),t.prototype.TotalTime=function(t){switch(t){case e.Scale.Weeks:return this.TotalWeeks;case e.Scale.Hours:return this.TotalHours/4;case e.Scale.Minutes:return 6*this.TotalHours}return this.TotalDays},t.prototype.toString=function(t){return void 0===t&&(t=e.Scale.Days),(t==e.Scale.Minutes?60*(24*this.days+this.hours)+this.minutes:(t==e.Scale.Hours?24*this.days+this.hours:(t==e.Scale.Weeks?Math.floor(this.days/7)+"w "+this.days%7:this.days)+"d "+this.hours)+"h "+this.minutes)+"m"+(this.seconds?" "+this.seconds+"s":"")},t.parse=function(e,n){var r=new t(0,0,0,0);if(e){if(this.canParse(e))try{var i=this.parseReg.exec(e);return new t(parseInt(i[1])||0,parseInt(i[2])||0,parseInt(i[3])||0,parseInt(i[4])||0,parseInt(i[5])||0)}catch(e){}n&&(r.TotalSeconds=Date.parse(e)/1e3-n)}return r},t.canParse=function(e){return this.parseReg.test(e)},t}();t.parseReg=/^\s*(?:(\d*)w)?\s*(?:(\d*)d)?\s*(?:(\d*)h)?\s*(?:(\d*)m)?\s*(?:(\d*)s)?\s*$/i,e.Duration=t}(TPP||(TPP={}));var QueryString=function(){var e={};return window.location.search.substring(1).split("&").forEach(function(t){if(t.indexOf("=")>0){var n=t.split("=");e[n.shift()]=decodeURI(n.join("="))}else e[t]="true"}),e}(),TPP;!function(e){var t;!function(e){var t=function(){function e(){this.OwnedDict={},this.HallOfFame=[]}return e}();e.RunSummaryBase=t;var n=function(){function e(){this.Summary=[],this.HallOfFame=[]}return e}();e.CollectionSummaryBase=n;var r=function(){function e(){this.Owners=[],this.HallOfFame=[]}return Object.defineProperty(e.prototype,"IsOwned",{get:function(){return this.Owners&&this.Owners.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"FirstOwnedRun",{get:function(){return this.IsOwned?this.Owners[0].Run:{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"FirstCaughtDate",{get:function(){return!!this.IsOwned&&this.Owners[0].CaughtOn},enumerable:!0,configurable:!0}),e}();e.DexEntryBase=r;var i;!function(e){e[e["Pokédex Number"]=0]="Pokédex Number",e[e.Alphabetical=1]="Alphabetical",e[e["First Owned"]=2]="First Owned"}(i=e.DexSorting||(e.DexSorting={}));var o=function(){function e(){this.Entries=[]}return Object.defineProperty(e.prototype,"NoGlitchMon",{get:function(){return this.Entries.filter(function(e){return!(0==e.Number&&"MissingNo."==e.Pokemon)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TotalOwned",{get:function(){return this.NoGlitchMon.filter(function(e){return e.IsOwned}).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TotalInDex",{get:function(){return this.NoGlitchMon.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OwnedPercentage",{get:function(){return this.TotalOwned/this.TotalInDex*100},enumerable:!0,configurable:!0}),e.prototype.SortDex=function(e){switch(void 0===e&&(e=0),e){case 0:case i[0]:default:this.Entries=this.Entries.sort(function(e,t){return e.Number-t.Number});break;case 1:case i[1]:this.Entries=this.Entries.sort(function(e,t){return e.Pokemon.localeCompare(t.Pokemon)});break;case 2:case i[2]:this.Entries=this.Entries.sort(function(e,t){return(e.FirstCaughtDate||Date.now())-(t.FirstCaughtDate||Date.now())})}},e.prototype.FilterDexToOwned=function(){this.Entries=this.Entries.filter(function(e){return e.IsOwned})},e.prototype.FilterDexToUnowned=function(){this.Entries=this.Entries.filter(function(e){return!e.IsOwned})},e.prototype.FilterDexRuns=function(e){var t=e.map(function(e){return"string"==typeof e?e.toLowerCase().trim():e});this.Entries=this.Entries.filter(function(e){return e.Owners.filter(function(e){return t.filter(function(t){return"string"==typeof t?e.Run.RunName.toLowerCase().indexOf(t)>=0:e.Run.RunName==t.RunName}).length>0}).length>0})},e.prototype.FilterDexPokemon=function(e){e=e.map(function(e){return e.toLowerCase().trim()}),this.Entries=this.Entries.filter(function(t){return e.indexOf(t.Pokemon.toLowerCase())>=0})},e.prototype.FilterDexToHallOfFame=function(){this.Entries=this.Entries.filter(function(e){return e.HallOfFame.length>0})},e}();e.GlobalDexBase=o}(t=e.Pokedex||(e.Pokedex={}))}(TPP||(TPP={}));var groupList,groups,zoomIn=zoomIn||function(){},zoomOut=zoomOut||zoomIn,pokedexGenerationsMenu=function(){return qsListMenu("fa-gamepad","Generations","g",Pokedex.GenSlice.map(function(e,t){return t?t.toFixed(0):null}),"All","Generation ")},pokedexRegionsMenu=function(){return qsListMenu("fa-globe","Region","dex",Object.keys(Pokedex.Regional).map(function(e,t){return t?e:null}),"National")},pokedexSortMenu=function(){return qsListMenu("fa-sort","Sort","sort",Object.keys(TPP.Pokedex.DexSorting).filter(function(e){return!isNaN(e)}).map(function(e){return parseInt(e)?TPP.Pokedex.DexSorting[e]:null}),TPP.Pokedex.DexSorting[0])},getTwitchVideos=getTwitchVideos||function(){};