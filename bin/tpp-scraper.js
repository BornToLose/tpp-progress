function Scrape(m){$(".doItLive").text("Live");var n=$.Deferred(),p=/(?:(\d*)w)? *(?:(\d*)d)? *(?:(\d*)h) *(?:(\d*)m) *(?:(\d*)s)?/im,c=/Attempt[^\d]*(\d*)/i,t=n.promise();return"http://twitchplayspokemon.org/"==m.Scraper.url?t=TppOrgApi(m,n):$.ajax({url:"http://crossorigin.me/"+m.Scraper.url,type:"GET",dataType:"text",timeout:1e3}).then(function(t){return t},function(t){return $.ajax({url:"http://cors.io/?u="+m.Scraper.url,type:"GET",dataType:"text",timeout:1e3})}).then(function(t){t=t.replace(/\bsrc=/gi,"crs=");var e=$(t).find(".last-update");m.Scraper.parts=m.Scraper.parts||["Badge","Elite Four"];var r=$(t).find(m.Scraper.parts.map(function(t){return"h3 strong:contains("+t+")"}).join(","));m.Scraper.runtime&&e.is("*")&&(m.Duration=(e.text().split(":").pop()||"0d").trim(),Duration.canParse(m.Duration)||(m.Duration=(new Date).toISOString()));var a,u={};m.Events.forEach(function(t){return u[(t.Name+t.Time).toLowerCase()]=t}),r.each(function(t,e){var o=$(e).text();for(var r=$(e).parent();r.nextAll("h3, .table-pokemon").first().is(".table-pokemon");)!function(i){i.find("th a").remove(),i.find("th").each(function(t,e){var r,n,a=i.find("tr td:nth-child("+(t+1)+")");a.find("img").is(".greyed-out")||(r=$(e).text().trim(),(n=((a.text().match(p)||[]).shift()||"").trim())&&Duration.canParse(n)&&!u[(r+n).toLowerCase()]&&m.Events.push({Group:o,Image:(a.find("img").attr("crs")||"").replace(/^\//,m.Scraper.url+"/"),Name:r,Time:n,Attempts:parseInt((a.text().match(c)||[]).pop()||"0"),New:!0}))})}(r=r.nextAll(".table-pokemon").first())}),m.Scraper.hostname&&(m.HostName=$(t).find('td.text-left:contains("Trainer Name")').next("td.text-right").text()||m.HostName),m.Scraper.pokemon&&(a={},m.Events.filter(function(t){return"Pokemon"==t.Group}).forEach(function(t){return a[t.Name]=t}),$(t).find(".history-obtained").each(function(){var t,e=$(this),r=e.find("img");t=r.is("*")?r.attr("title")||"":e.attr("title").split("(").shift().trim();var n=e.text().replace(/[()]/g,"").trim();!a[t]&&Duration.canParse(n)&&(a[t]={Name:t,Time:n,Group:"Pokemon",New:!0})}),Object.keys(a).filter(function(t){return!u[(a[t].Name+a[t].Time).toLowerCase()]}).forEach(function(t){return m.Events.push(a[t])})),n.resolve(m),$(t).find("img").attr("src","")},function(){return n.reject("Could not load live run data.")}),t.then(function(t){return t},function(t){return $.when(m)})}function TppOrgApi(r,t){function e(t){return t.filter(function(t){return!!t.Time}).forEach(function(t){var e=(t.Name+Duration.parse(t.Time,r.StartTime).toString()).toLowerCase();a[e]||(r.Events.push(t),(a[e]=t).New=!0)})}var n=[],a={},i={},o="";return r.Scraper.runtime&&n.push($.get("http://api.twitchplayspokemon.org/v1/general").then(function(t){return r.Duration=new Date(1e3*t.data.pop().last_update_unix).toISOString()})),0<=r.Scraper.parts.indexOf("Badge")&&n.push($.get("http://api.twitchplayspokemon.org/v1/badges").then(function(t){return e(t.data.filter(function(t){return t.time_unix>=r.StartTime}).map(function(t){return{Group:(0<=t.region.toLowerCase().indexOf("rematch")?"Rematch ":"")+"Badges",Name:t.name.trim()+" Badge",Time:new Date(1e3*t.time_unix).toISOString(),Attempts:t.attempts,Image:"img/badges/"+(0<=t.region.toLowerCase().indexOf("rematch")?"rematch/":"")+t.name.toLowerCase()+".png"}}))})),0<=r.Scraper.parts.indexOf("Elite Four")&&n.push($.get("http://api.twitchplayspokemon.org/v1/elite-four").then(function(t){return e(t.data.filter(function(t){return t.time_unix>=r.StartTime}).map(function(t){return{Group:"Elite Four"+(t.is_rematch?" Rematch":""),Name:t.name.trim(),Time:new Date(1e3*t.time_unix).toISOString(),Attempts:t.attempts,Image:"img/trainers/"+o+(t.is_rematch?"rematch/":"")+t.name.toLowerCase()+".png"}}))})),r.Scraper.pokemon&&n.push($.get("http://api.twitchplayspokemon.org/v1/pokemon-timeline").then(function(t){return t.data.filter(function(t){return t.time_unix>=r.StartTime}).map(function(t){return{Group:"Pokemon",Name:t.pokemon.trim(),Time:new Date(1e3*t.time_unix).toISOString()}}).forEach(function(t){var e=t.Name.toLowerCase();(!i[e]||Duration.parse(i[e].Time,r.StartTime).TotalSeconds>Duration.parse(t.Time,r.StartTime).TotalSeconds)&&(i[e]=t)}),e(Object.keys(i).map(function(t){return i[t]}))})),n.length?($.when.apply($,n).then(function(){t.resolve(r)},t.reject),r.Events.forEach(function(t){return a[(t.Name+Duration.parse(t.Time,r.StartTime).toString()).toLowerCase()]=t}),r.Events.filter(function(t){return"Pokemon"==t.Group}).forEach(function(t){return i[t.Name.toLowerCase()]=t}),o=(r.BaseGame?r.BaseGame:r.RunName).toLowerCase().replace(/(randomized)|(anniversary)|([^a-z0-9]*)/gi,"")+"/"):t.reject("Nothing to fetch!"),t.promise()}