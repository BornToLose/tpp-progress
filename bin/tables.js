var RunSummary=function(e){this.RunName=e.RunName,this.StartDate=new Date(1e3*e.StartTime),this.Duration=Duration.parse(e.Duration,e.StartTime),this.HostName=e.HostName,this.Badges=e.Events.filter(function(e){return"Badges"==e.Group}).length,this.Pokedex=e.Events.filter(function(e){return"Pokemon"==e.Group&&"Egg"!=e.Name}).length},PokedexSummary=function(r){var i=this;this.Run=r,this.HallOfFame=[],r.Events.filter(function(e){return"Pokemon"==e.Group&&(0<=PokeList.indexOf(e.Name)||0<=PokeList.indexOf(e.Class))}).length&&(this.OwnedDict={},PokeList.forEach(function(e){return i.OwnedDict[e]=!1}),r.Events.filter(function(e){return"Pokemon"==e.Group}).forEach(function(e){0<=PokeList.indexOf(e.Name)?i.OwnedDict[e.Name]=Duration.parse(e.Time,r.StartTime).TotalSeconds+r.StartTime:0<=PokeList.indexOf(e.Class)&&(i.OwnedDict[e.Class]=Duration.parse(e.Time,r.StartTime).TotalSeconds+r.StartTime)}),r.Events.filter(function(e){return e.Party&&0<=Duration.parse(e.Time,r.StartTime).TotalSeconds}).forEach(function(t){return t.Party.forEach(function(e){var n=0<=PokeList.indexOf(e.Pokemon)?e.Pokemon:0<=PokeList.indexOf(e.Class)?e.Class:null;n&&i.HallOfFame.push({Pokemon:n,Ribbon:t.Image,RunName:r.RunName,HostName:r.HostName,Nickname:(e.Nickname||e.Pokemon).replace(/π/g,"ᴾk").replace(/µ/g,"ᴹn"),UnmodifiedNick:e.Nickname,PreviousNick:e.PreviousNick,Time:Duration.parse(t.Time,r.StartTime).TotalSeconds+r.StartTime})})}))};function generateRunSummary(e){var n=$("<table>").append($("<thead>").append($("<tr>").append(["Run","Started","Duration","Host","Badges Earned","Species Caught"].map(function(e){return $("<th>").text(e)})))),i=$("<tbody>").appendTo(n);return e.forEach(function(r){return r.Runs.forEach(function(n){var t;1e3*n.StartTime>Date.now()||(t=$("<tr>"),i.append(t),$.when(n.Scraper?Scrape(n):n).then(function(e){return new RunSummary(e)}).then(function(e){return t.append([e.RunName,e.StartDate.toISOString(),e.Duration.toString(r.Scale),e.HostName,e.Badges,e.Pokedex||"-----"].map(function(e){return $("<td>").text(e)})).css({"background-color":n.ColorPrimary,"border-color":n.ColorSecondary})}))})}),n}function dexSummarize(e){return $.when.apply($,Array.prototype.concat.apply([],e.map(function(e){return e.Runs.map(function(e){return $.when(e.Scraper&&e.Scraper.pokemon?Scrape(e):e).then(function(e){return new PokedexSummary(e)})})}))).then(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.filter(function(e){return!!e.OwnedDict})})}function generatePokedexSummary(e){var n=$("<table>");return dexSummarize(e).then(function(e){n.append($("<thead>").append($("<tr>").append($("<th>").text("Pokemon")).append(e.map(function(e){return $("<th>").text(e.Run.RunName).css({"background-color":e.Run.ColorPrimary,"border-color":e.Run.ColorSecondary})})))),$("<tbody>").appendTo(n).append(PokeList.map(function(n){return $("<tr>").append($("<th>").text(n)).append(e.map(function(e){return $("<td>").text(e.OwnedDict[n]?"X":"").css({"background-color":e.Run.ColorPrimary,"border-color":e.Run.ColorSecondary,"text-align":"center"})}))}))}),n}function generateGlobalDex(e){var t,r,i=$("<div>").append("<i class='fa fa-spinner fa-pulse'>"),m=function(e,n){return!0},p=QueryString.justmon,h=!!QueryString.hofonly,g=!!QueryString.owned;return QueryString.nowifi&&e.forEach(function(e){return e.Runs.forEach(function(e){return e.Events=e.Events.filter(function(e){return"WifiTrade"!=e.Class})})}),QueryString.ms&&$("#pokedex").addClass("ms"),QueryString.only&&(e=e.filter(function(n){return 0<QueryString.only.split(",").filter(function(e){return 0<=n.Name.indexOf(e.trim())}).length})),QueryString.pokemon&&(t=QueryString.pokemon.split(",").map(function(e){return e.trim().toLowerCase()}),m=function(e,n){return!t.length||0<=t.indexOf(e.toLowerCase())||0<=t.indexOf(n.toString())||!!t.filter(function(e){return 0<parseInt(e)&&parseInt(e)==n}).length}),QueryString.run&&(e=e.map(function(e){return e.Runs=e.Runs.filter(function(n){return 0<QueryString.run.split(",").filter(function(e){return 0<=n.RunName.indexOf(e.trim())}).length}),e.Runs.forEach(function(e){return $("#pokedex").addClass(cleanString(e.RunName))}),e}).filter(function(e){return 0<e.Runs.length})),QueryString.g&&(PokeList=PokeList.slice(0,(GenSlice[parseInt(QueryString.g||"0")]||PokeList.length)+1)),QueryString.dex&&(r=Array.prototype.concat.apply(["National"],Object.keys(Regional).filter(function(e){return e.toLowerCase()==QueryString.dex.toLowerCase()})).pop(),PokeList=Regional[r].map(function(e){return"string"==typeof e?e:PokeList[e]}),$("#dexName").text(r+(0<r.toLowerCase().indexOf("book")+r.indexOf("dex")?"":" Pokédex")),$("#pokedex").addClass(specialClasses[r]),runRestrictions[r]&&(e=e.map(function(e){return e.Runs=e.Runs.filter(function(n){return 0<runRestrictions[r].toLowerCase().split(",").filter(function(e){return 0<=n.RunName.toLowerCase().indexOf(e.trim())}).length}),e}).filter(function(e){return 0<e.Runs.length}))),"Alphabetical"==QueryString.sort&&PokeList.sort(),"First Owned"==QueryString.sort&&dexSummarize(e).then(function(e){var i={};PokeList.forEach(function(e){return i[e]=!1}),e.forEach(function(t){t.OwnedDict&&Object.keys(t.OwnedDict).forEach(function(e){var n=t.OwnedDict[e];n&&(!i[e]||i[e]>n)&&(i[e]=n)})}),PokeList.sort(function(e,n){var t=i[e],r=i[n];return t?r?t-r:-1:r?1:0})}),dexSummarize(e).then(function(d){d=d.sort(function(e,n){return e.Run.StartTime-n.Run.StartTime});var e,n,t,f=(f=d.map(function(e){return e.HallOfFame}).reduce(function(e,n){return e.concat(n)}).sort(function(e,n){return e.Time-n.Time})).filter(function(n){return f.filter(function(e){return e.HostName==n.HostName&&e.Pokemon==n.Pokemon&&(e.Nickname==n.Nickname||n.PreviousNick==e.UnmodifiedNick)}).shift()==n}),l={};i.find("*").remove(),i.append(PokeList.map(function(t,e){if(t){var r,n=e.toString(),i=("000"+n).substring(n.length),o=cleanString(t)||"unidentified",a=$("<div class='dexEntry'>").append("<h3>"+i+"</h3>").append("<h4>"+t+"</h4>").append("<div class='pokesprite "+o+"'><img src='img/missingno.png'></div>"),u=[];if(p)a.addClass("owned");else{var s=f.filter(function(e){return e.Pokemon==t});if(s.length){var c=$("<div>").addClass("hofRibbon").appendTo(a);s.forEach(function(e){var n=e.HostName+"'s "+e.Nickname+" ("+e.RunName+")";c.append($("<img>").attr("src",e.Ribbon).attr("alt",n).attr("title",n))})}else if(h)return a.hide();d.forEach(function(e){var n=u.push;e.OwnedDict[t]&&(a.addClass("owned"),l[t]=l[t]||e.OwnedDict[t],r=r||e.Run.ColorPrimary,e.OwnedDict[t]<l[t]&&(l[t]=e.OwnedDict[t],r=e.Run.ColorPrimary,n=u.unshift),(!e.Run.Revisit||u.indexOf(e.Run.HostName+" ("+e.Run.Revisit.Run+")")<0)&&n.call(u,e.Run.HostName+" ("+e.Run.RunName+")"))})}return u.length?a.attr("title","Owned by:\n"+u.join("\n")):g?a.hide():p||a.attr("title","Didn't Catch"),r&&a.css("background-color",r),"MissingNo."==t&&(l[t]?delete l[t]:a.hide()),m(t,e)||a.hide(),a}})),p?i.prepend("<br>"):(t=((e=Object.keys(l).filter(m).length)/(n=PokeList.filter(function(e,n){return!!e&&"MissingNo."!=e&&m(e,n)}).length)*100).toFixed(1),i.prepend("<h2 class='total'>Owned: <span>"+e+"/"+n+" ("+t+"%)</span></div>"))}),i}var PokeList=Pokedex.PokeList,GenSlice=Pokedex.GenSlice,Regional=Pokedex.Regional,specialClasses=Pokedex.specialClasses,runRestrictions=Pokedex.runRestrictions;