function generateRunSummary(e){var n=$("<table>").append($("<thead>").append($("<tr>").append(["Run","Started","Duration","Host","Badges Earned","Species Caught"].map(function(e){return $("<th>").text(e)})))),t=$("<tbody>").appendTo(n);return e.forEach(function(e){return e.Runs.forEach(function(n){if(!(1e3*n.StartTime>Date.now())){var r=$("<tr>");t.append(r),$.when(n.Scraper?Scrape(n):n).then(function(e){return new RunSummary(e)}).then(function(t){return r.append([t.RunName,t.StartDate.toISOString(),t.Duration.toString(e.Scale),t.HostName,t.Badges,t.Pokedex||"-----"].map(function(e){return $("<td>").text(e)})).css({"background-color":n.ColorPrimary,"border-color":n.ColorSecondary})})}})}),n}function dexSummarize(e){return $.when.apply($,Array.prototype.concat.apply([],e.map(function(e){return e.Runs.map(function(e){return $.when(e.Scraper&&e.Scraper.pokemon?Scrape(e):e).then(function(e){return new PokedexSummary(e)})})}))).then(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.filter(function(e){return!!e.OwnedDict})})}function generatePokedexSummary(e){var n=$("<table>");return dexSummarize(e).then(function(e){n.append($("<thead>").append($("<tr>").append($("<th>").text("Pokemon")).append(e.map(function(e){return $("<th>").text(e.Run.RunName).css({"background-color":e.Run.ColorPrimary,"border-color":e.Run.ColorSecondary})})))),$("<tbody>").appendTo(n).append(PokeList.map(function(n){return $("<tr>").append($("<th>").text(n)).append(e.map(function(e){return $("<td>").text(e.OwnedDict[n]?"X":"").css({"background-color":e.Run.ColorPrimary,"border-color":e.Run.ColorSecondary,"text-align":"center"})}))}))}),n}function generateGlobalDex(e){var n=$("<div>").append("<i class='fa fa-spinner fa-pulse'>"),t=function(e,n){return!0},r=QueryString.justmon,i=!!QueryString.hofonly,o=!!QueryString.owned;if(QueryString.nowifi&&e.forEach(function(e){return e.Runs.forEach(function(e){return e.Events=e.Events.filter(function(e){return"WifiTrade"!=e.Class})})}),QueryString.ms&&$("#pokedex").addClass("ms"),QueryString.only&&(e=e.filter(function(e){return QueryString.only.split(",").filter(function(n){return e.Name.indexOf(n.trim())>=0}).length>0})),QueryString.pokemon){var a=QueryString.pokemon.split(",").map(function(e){return e.trim().toLowerCase()});t=function(e,n){return!a.length||a.indexOf(e.toLowerCase())>=0||a.indexOf(n.toString())>=0||!!a.filter(function(e){return parseInt(e)>0&&parseInt(e)==n}).length}}if(QueryString.run&&(e=e.map(function(e){return e.Runs=e.Runs.filter(function(e){return QueryString.run.split(",").filter(function(n){return e.RunName.indexOf(n.trim())>=0}).length>0}),e.Runs.forEach(function(e){return $("#pokedex").addClass(cleanString(e.RunName))}),e}).filter(function(e){return e.Runs.length>0})),QueryString.g&&(PokeList=PokeList.slice(0,(GenSlice[parseInt(QueryString.g||"0")]||PokeList.length)+1)),QueryString.dex){var u=Array.prototype.concat.apply(["National"],Object.keys(Regional).filter(function(e){return e.toLowerCase()==QueryString.dex.toLowerCase()})).pop();PokeList=Regional[u].map(function(e){return"string"==typeof e?e:PokeList[e]}),$("#dexName").text(u+(u.toLowerCase().indexOf("book")+u.indexOf("dex")>0?"":" Pokédex")),$("#pokedex").addClass(specialClasses[u]),runRestrictions[u]&&(e=e.map(function(e){return e.Runs=e.Runs.filter(function(e){return runRestrictions[u].toLowerCase().split(",").filter(function(n){return e.RunName.toLowerCase().indexOf(n.trim())>=0}).length>0}),e}).filter(function(e){return e.Runs.length>0}))}return"Alphabetical"==QueryString.sort&&PokeList.sort(),"First Owned"==QueryString.sort&&dexSummarize(e).then(function(e){var n={};PokeList.forEach(function(e){return n[e]=!1}),e.forEach(function(e){e.OwnedDict&&Object.keys(e.OwnedDict).forEach(function(t){var r=e.OwnedDict[t];r&&(n[t]?n[t]>r&&(n[t]=r):n[t]=r)})}),PokeList.sort(function(e,t){var r=n[e],i=n[t];return r?i?r-i:-1:i?1:0})}),dexSummarize(e).then(function(e){e=e.sort(function(e,n){return e.Run.StartTime-n.Run.StartTime});var a=e.map(function(e){return e.HallOfFame}).reduce(function(e,n){return e.concat(n)}).sort(function(e,n){return e.Time-n.Time});a=a.filter(function(e){return a.filter(function(n){return n.HostName==e.HostName&&n.Pokemon==e.Pokemon&&(n.Nickname==e.Nickname||e.PreviousNick==n.UnmodifiedNick)}).shift()==e});var u={};if(n.find("*").remove(),n.append(PokeList.map(function(n,s){if(n){var c,f=s.toString(),d=("000"+f).substring(f.length),l=cleanString(n)||"unidentified",m=$("<div class='dexEntry'>").append("<h3>"+d+"</h3>").append("<h4>"+n+"</h4>").append("<div class='pokesprite "+l+"'><img src='img/missingno.png'></div>"),p=[];if(r)m.addClass("owned");else{var h=a.filter(function(e){return e.Pokemon==n});if(h.length){var g=$("<div>").addClass("hofRibbon").appendTo(m);h.forEach(function(e){var n=e.HostName+"'s "+e.Nickname+" ("+e.RunName+")";g.append($("<img>").attr("src",e.Ribbon).attr("alt",n).attr("title",n))})}else if(i)return m.hide();e.forEach(function(e){var t=p.push;e.OwnedDict[n]&&(m.addClass("owned"),u[n]=u[n]||e.OwnedDict[n],c=c||e.Run.ColorPrimary,e.OwnedDict[n]<u[n]&&(u[n]=e.OwnedDict[n],c=e.Run.ColorPrimary,t=p.unshift),(!e.Run.Revisit||p.indexOf(e.Run.HostName+" ("+e.Run.Revisit.Run+")")<0)&&t.call(p,e.Run.HostName+" ("+e.Run.RunName+")"))})}return p.length?m.attr("title","Owned by:\n"+p.join("\n")):o?m.hide():r||m.attr("title","Didn't Catch"),c&&m.css("background-color",c),"MissingNo."==n&&(u[n]?delete u[n]:m.hide()),t(n,s)||m.hide(),m}})),r)n.prepend("<br>");else{var s=Object.keys(u).filter(t).length,c=PokeList.filter(function(e,n){return!!e&&"MissingNo."!=e&&t(e,n)}).length,f=(s/c*100).toFixed(1);n.prepend("<h2 class='total'>Owned: <span>"+s+"/"+c+" ("+f+"%)</span></div>")}}),n}var RunSummary=function(){function e(e){this.RunName=e.RunName,this.StartDate=new Date(1e3*e.StartTime),this.Duration=Duration.parse(e.Duration,e.StartTime),this.HostName=e.HostName,this.Badges=e.Events.filter(function(e){return"Badges"==e.Group}).length,this.Pokedex=e.Events.filter(function(e){return"Pokemon"==e.Group&&"Egg"!=e.Name}).length}return e}(),PokedexSummary=function(){function e(e){var n=this;this.Run=e,this.HallOfFame=[],e.Events.filter(function(e){return"Pokemon"==e.Group&&(PokeList.indexOf(e.Name)>=0||PokeList.indexOf(e.Class)>=0)}).length&&(this.OwnedDict={},PokeList.forEach(function(e){return n.OwnedDict[e]=!1}),e.Events.filter(function(e){return"Pokemon"==e.Group}).forEach(function(t){PokeList.indexOf(t.Name)>=0?n.OwnedDict[t.Name]=Duration.parse(t.Time,e.StartTime).TotalSeconds+e.StartTime:PokeList.indexOf(t.Class)>=0&&(n.OwnedDict[t.Class]=Duration.parse(t.Time,e.StartTime).TotalSeconds+e.StartTime)}),e.Events.filter(function(n){return n.Party&&Duration.parse(n.Time,e.StartTime).TotalSeconds>=0}).forEach(function(t){return t.Party.forEach(function(r){var i=PokeList.indexOf(r.Pokemon)>=0?r.Pokemon:PokeList.indexOf(r.Class)>=0?r.Class:null;i&&n.HallOfFame.push({Pokemon:i,Ribbon:t.Image,RunName:e.RunName,HostName:e.HostName,Nickname:(r.Nickname||r.Pokemon).replace(/π/g,"ᴾk").replace(/µ/g,"ᴹn"),UnmodifiedNick:r.Nickname,PreviousNick:r.PreviousNick,Time:Duration.parse(t.Time,e.StartTime).TotalSeconds+e.StartTime})})}))}return e}(),PokeList=Pokedex.PokeList,GenSlice=Pokedex.GenSlice,Regional=Pokedex.Regional,specialClasses=Pokedex.specialClasses,runRestrictions=Pokedex.runRestrictions;