function scrapeRun(t,e){e=e.replace(/\bsrc\=/gi,"crs=");var r=$(e).find(".last-update");t.Scraper.parts=t.Scraper.parts||["Badge","Elite Four"];var n=$(e).find(t.Scraper.parts.map(function(t){return"h3 strong:contains("+t+")"}).join(","));t.Scraper.runtime&&r.is("*")&&(t.Duration=(r.text().split(":").pop()||"0d").trim(),Duration.canParse(t.Duration)||(t.Duration=(new Date).toISOString()));var a={};if(t.Events.forEach(function(t){return a[t.Name+t.Time]=t}),n.each(function(e,r){var n=$(r).parent().next(".table-pokemon"),i=$(r).text();n.find("th").each(function(e,r){var o=$(r).text(),u=n.find("tr td:nth-child("+(e+1)+")"),c=$(u[1]).text().trim();u.find("img").is(".greyed-out")||a[o+c]||t.Events.push({Group:i,Image:(u.find("img").attr("crs")||"").replace(/^\//,t.Scraper.url+"/"),Name:o,Time:c,Attempts:parseInt(u.find("strong").text()||"0"),New:!0})})}),t.Scraper.hostname&&(t.HostName=$(e).find('td.text-left:contains("Trainer Name")').next("td.text-right").text()||t.HostName),t.Scraper.pokemon){var i={};t.Events.filter(function(t){return"Pokemon"==t.Group}).forEach(function(t){return i[t.Name]=t}),$(e).find(".history-obtained").each(function(){var t=$(this),e=t.find("img");if(e.is("*"))var r=e.attr("title")||"";else var r=t.attr("title").split("(").shift().trim();var n=t.text().replace(/[()]/g,"").trim();!i[r]&&Duration.canParse(n)&&(i[r]={Name:r,Time:n,Group:"Pokemon",New:!0})}),Object.keys(i).forEach(function(e){return t.Events.push(i[e])})}}var tppNg=angular.module("tpp-progress",[]),tppData=tppData;tppNg.controller("credits",function(t){t.extraCredits=[{Name:"TheSwordUser"},{Name:"UDie2day"},{Name:"AsterJ"},{Name:"Rabbeseking"},{Name:"Tiesoul"},{Name:"valence_d",User:"Persona_Alio"},{Name:"ChezMere"},{Name:"T-chan"},{Name:"yoshord"},{Name:"Sir_WRA",User:"Sir_W_R_Armchair"}],t.live=tppData.filter(function(t){return t.Runs.filter(function(t){return t.Scraper&&!0}).length>0}).length>0?"Live":"Most"}),tppNg.controller("progressCharts",function(t,e){tppData.forEach(function(t){return t.Runs.forEach(function(t,r){if(t.StartTime=t.StartTime||(t.StartDate?Math.floor(Date.parse(t.StartDate)/1e3):0),t.Scraper){var n=function(){return e.get("https://crossorigin.me/"+t.Scraper.url).then(function(e){return scrapeRun(t,e.data)})};n(),t.Duration="0d",setInterval(function(){return n()},9e5)}if(t.CopyEvents){var a=[];tppData.forEach(function(e){return e.Runs.filter(function(e){return t.CopyEvents.indexOf(e.RunName)>=0}).forEach(function(t){return a=a.concat.apply(a,t.Events)})}),a.forEach(function(e){return t.Events.filter(function(t){return t.Name==e.Name&&t.Time==e.Time}).length?"":t.Events.push(e)})}})}),t.tppData=tppData.filter(function(t){return t.Runs.filter(function(t){return t.StartTime<Date.now()/1e3}).length>0}),t.cleanText=function(t){return t.replace(/[^A-Z0-9-]/gi,"").toLowerCase()},t.duration=function(t,e,r){return void 0===e&&(e=TPP.Scale.Weeks),Duration.parse(t,r).toString(e)},t.time=function(t,e,r){return void 0===e&&(e=TPP.Scale.Days),Duration.parse(t,r).TotalTime(e)},t.width=function(e,r,n){return void 0===r&&(r=TPP.Scale.Days),t.time(e,r,n)*t.ppd},t.ppd=64,t.concurrentRuns=function(t,e){if(void 0===e&&(e=TPP.Scale.Days),!t.ContainsRunsFrom)return[];var r=Duration.parse(t.Duration),n=t.StartTime+r.TotalSeconds;return tppData.filter(function(e){return t.ContainsRunsFrom.indexOf(e.Name)>=0}).map(function(r){return r.Runs.filter(function(e){return t.StartTime<e.StartTime&&n>e.StartTime}).map(function(n){var a=Duration.parse(n.StartDate,t.StartTime),i=Duration.parse(n.Duration,n.StartTime);return n.Label=(r.SingularName||r.Name)+"\n"+n.RunName+"\nStarted: "+a.toString(e)+(n.Ongoing?"":"\nEnded: "+i.toString(e)),n})})},t.steps=function(t){var e=new Duration(0);t.Runs.filter(function(t){return t.StartTime<Date.now()/1e3}).forEach(function(t){var r=Duration.parse(t.EndDate||t.Duration,t.StartTime);e.TotalSeconds<r.TotalSeconds&&(e=r)});for(var r=e.TotalTime(t.Scale),n=[],a=0;a<=r+1;n.push(a++));return n},t.makeGrid=function(e){void 0===e&&(e=t.ppd);var r=document.createElement("canvas");r.height=1,r.width=e/2;var n=r.getContext("2d");return n.strokeStyle="darkgray",n.moveTo(e/2,-1),n.lineTo(e/2,2),n.stroke(),r.toDataURL()},t.scale=function(t){return TPP.Scale[t]},t.zoomIn=function(){return t.ppd*=2},t.zoomOut=function(){return t.ppd/=2}});