function Scrape(t){$(".doItLive").text("Live");var e=$.Deferred(),r=/(?:(\d*)w)? *(?:(\d*)d)? *(?:(\d*)h) *(?:(\d*)m) *(?:(\d*)s)?/im,n=/Attempt[^\d]*(\d*)/i,a=e.promise();return"http://twitchplayspokemon.org/"==t.Scraper.url?a=TppOrgApi(t,e):$.ajax({url:"http://crossorigin.me/"+t.Scraper.url,type:"GET",dataType:"text",timeout:1e3}).then(function(t){return t},function(e){return $.ajax({url:"http://cors.io/?u="+t.Scraper.url,type:"GET",dataType:"text",timeout:1e3})}).then(function(a){a=a.replace(/\bsrc=/gi,"crs=");var i=$(a).find(".last-update");t.Scraper.parts=t.Scraper.parts||["Badge","Elite Four"];var o=$(a).find(t.Scraper.parts.map(function(t){return"h3 strong:contains("+t+")"}).join(","));t.Scraper.runtime&&i.is("*")&&(t.Duration=(i.text().split(":").pop()||"0d").trim(),Duration.canParse(t.Duration)||(t.Duration=(new Date).toISOString()));var u={};if(t.Events.forEach(function(t){return u[(t.Name+t.Time).toLowerCase()]=t}),o.each(function(e,a){function i(e){e.find("th a").remove(),e.find("th").each(function(a,i){var m=e.find("tr td:nth-child("+(a+1)+")");if(!m.find("img").is(".greyed-out")){var p=$(i).text().trim(),c=((m.text().match(r)||[]).shift()||"").trim();c&&Duration.canParse(c)&&!u[(p+c).toLowerCase()]&&t.Events.push({Group:o,Image:(m.find("img").attr("crs")||"").replace(/^\//,t.Scraper.url+"/"),Name:p,Time:c,Attempts:parseInt((m.text().match(n)||[]).pop()||"0"),New:!0})}})}for(var o=$(a).text(),m=$(a).parent();m.nextAll("h3, .table-pokemon").first().is(".table-pokemon");)i(m=m.nextAll(".table-pokemon").first())}),t.Scraper.hostname&&(t.HostName=$(a).find('td.text-left:contains("Trainer Name")').next("td.text-right").text()||t.HostName),t.Scraper.pokemon){var m={};t.Events.filter(function(t){return"Pokemon"==t.Group}).forEach(function(t){return m[t.Name]=t}),$(a).find(".history-obtained").each(function(){var t=$(this),e=t.find("img");if(e.is("*"))var r=e.attr("title")||"";else var r=t.attr("title").split("(").shift().trim();var n=t.text().replace(/[()]/g,"").trim();!m[r]&&Duration.canParse(n)&&(m[r]={Name:r,Time:n,Group:"Pokemon",New:!0})}),Object.keys(m).filter(function(t){return!u[(m[t].Name+m[t].Time).toLowerCase()]}).forEach(function(e){return t.Events.push(m[e])})}e.resolve(t),$(a).find("img").attr("src","")},function(){return e.reject("Could not load live run data.")}),a.then(function(t){return t},function(e){return $.when(t)})}function TppOrgApi(t,e){var r=[],n={},a={},i="",o=function(e){return e.filter(function(t){return!!t.Time}).forEach(function(e){var r=(e.Name+Duration.parse(e.Time,t.StartTime).toString()).toLowerCase();n[r]||(t.Events.push(e),n[r]=e,e.New=!0)})};return t.Scraper.runtime&&r.push($.get("http://api.twitchplayspokemon.org/v1/general").then(function(e){return t.Duration=new Date(1e3*e.data.pop().last_update_unix).toISOString()})),t.Scraper.parts.indexOf("Badge")>=0&&r.push($.get("http://api.twitchplayspokemon.org/v1/badges").then(function(e){return o(e.data.filter(function(e){return e.time_unix>=t.StartTime}).map(function(t){return{Group:(t.region.toLowerCase().indexOf("rematch")>=0?"Rematch ":"")+"Badges",Name:t.name.trim()+" Badge",Time:new Date(1e3*t.time_unix).toISOString(),Attempts:t.attempts,Image:"img/badges/"+(t.region.toLowerCase().indexOf("rematch")>=0?"rematch/":"")+t.name.toLowerCase()+".png"}}))})),t.Scraper.parts.indexOf("Elite Four")>=0&&r.push($.get("http://api.twitchplayspokemon.org/v1/elite-four").then(function(e){return o(e.data.filter(function(e){return e.time_unix>=t.StartTime}).map(function(t){return{Group:"Elite Four"+(t.is_rematch?" Rematch":""),Name:t.name.trim(),Time:new Date(1e3*t.time_unix).toISOString(),Attempts:t.attempts,Image:"img/trainers/"+i+(t.is_rematch?"rematch/":"")+t.name.toLowerCase()+".png"}}))})),t.Scraper.pokemon&&r.push($.get("http://api.twitchplayspokemon.org/v1/pokemon-timeline").then(function(e){return e.data.filter(function(e){return e.time_unix>=t.StartTime}).map(function(t){return{Group:"Pokemon",Name:t.pokemon.trim(),Time:new Date(1e3*t.time_unix).toISOString()}}).forEach(function(e){var r=e.Name.toLowerCase();(!a[r]||Duration.parse(a[r].Time,t.StartTime).TotalSeconds>Duration.parse(e.Time,t.StartTime).TotalSeconds)&&(a[r]=e)}),o(Object.keys(a).map(function(t){return a[t]}))})),r.length?($.when.apply($,r).then(function(){e.resolve(t)},e.reject),t.Events.forEach(function(e){return n[(e.Name+Duration.parse(e.Time,t.StartTime).toString()).toLowerCase()]=e}),t.Events.filter(function(t){return"Pokemon"==t.Group}).forEach(function(t){return a[t.Name.toLowerCase()]=t}),i=(t.BaseGame?t.BaseGame:t.RunName).toLowerCase().replace(/(randomized)|(anniversary)|([^a-z0-9]*)/gi,"")+"/"):e.reject("Nothing to fetch!"),e.promise()}